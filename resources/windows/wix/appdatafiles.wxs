<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi' xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <!--
    Puppet Agent Specific Application data
    These directories and files need to be special cased
    in order to manage the application data for puppet
    agent. The specific special case is that all files
    and folders here need to be persistent across multiple
    installs and uninstalls. We can do so by specifying
    Permanent="yes" on each file/folder component.
  -->
  <Fragment>
    <DirectoryRef Id="TARGETDIR">
      <Directory Id="APPDATADIR" Name="PuppetForager">
        <Directory Id="ApplicationBlahBlahBlah" Name="Forager">
          <Directory Id="PuppetAppData" Name="puppet">
            <Directory Id="PuppetConfDir" Name="etc"/>
            <Directory Id="PuppetVarDir" Name="var"/>
          </Directory>
          <Directory Id="FacterAppData" Name="facter">
            <Directory Id="FactsDotD" Name="facts.d"/>
          </Directory>
          <Directory Id="CodeDir" Name="code">
            <Directory Id="HieraDataDir" Name="hieradata"/>
            <Directory Id="CodeModulesDir" Name="modules"/>
            <Directory Id="EnvironmentsDir" Name="environments">
              <Directory Id="ProductionDir" Name="production">
                <Directory Id="ManifestsDir" Name="manifests"/>
                <Directory Id="ModulesDir" Name="modules"/>
              </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>
    </DirectoryRef>
    <ComponentGroup Id="AppDataComponentGroup" >
      <!-- This is a permanent directory, do not remove on uninstall -->
      <Component
        Id="PuppetConfUnconditionalSettings"
        Permanent="no"
        Guid="B9179A60-483F-4F32-8E3F-AD632B0DEBB4"
        Directory="PuppetConfDir">
        <CreateFolder />
        <IniFile
          Id="PuppetConfServer" Name="puppet.conf"
          Action="addLine"
          Section="main"
          Key="server" Value="[PUPPET_MASTER_SERVER]"
          Directory="PuppetConfDir" />
        <IniFile
          Id="RemovePuppetConfPluginSync" Name="puppet.conf"
          Action="removeLine"
          Section="main"
          Key="pluginsync"
          Directory="PuppetConfDir" />
        <IniFile
          Id="PuppetConfAutoflush" Name="puppet.conf"
          Action="createLine"
          Section="main"
          Key="autoflush" Value="true"
          Directory="PuppetConfDir" />
      </Component>
      <Component
        Id="PuppetConfWithAgentEnvironment"
        Permanent="no"
        Guid="EC56FB39-A176-42BA-BB1C-10C8DE76AE67"
        Directory="PuppetConfDir">
        <Condition>PUPPET_AGENT_ENVIRONMENT</Condition>
        <CreateFolder />
        <!-- The agent environment setting will only be managed if the
              PUPPET_AGENT_ENVIRONMENT is not an empty string -->
        <!-- Manage the entry itself -->
        <IniFile
          Id="PuppetConfAgentEnvironment" Name="puppet.conf"
          Action="addLine"
          Section="main"
          Key="environment" Value="[PUPPET_AGENT_ENVIRONMENT]"
          Directory="PuppetConfDir" />
      </Component>
      <Component
        Id="PuppetConfWithCertname"
        Permanent="yes"
        Guid="5D1813E1-0AEB-4965-B504-354D7F10DCEA"
        Directory="PuppetConfDir">
        <Condition>PUPPET_AGENT_CERTNAME</Condition>
        <CreateFolder />
        <!-- The certname setting will only be managed if the
              PUPPET_AGENT_CERTNAME is not an empty string -->
        <!-- Manage the entry itself -->
        <IniFile
          Id="PuppetConfCertname" Name="puppet.conf"
          Action="addLine"
          Section="main"
          Key="certname" Value="[PUPPET_AGENT_CERTNAME]"
          Directory="PuppetConfDir" />
      </Component>
      <Component
        Id="PuppetConfWithCaServer"
        Permanent="no"
        Guid="CE676CF1-2E12-4CDC-B87F-D4BC4E71FF85"
        Directory="PuppetConfDir">
        <Condition>PUPPET_CA_SERVER</Condition>
        <CreateFolder />
        <!-- The certname setting will only be managed if the
              PUPPET_CA_SERVER is not an empty string -->
        <IniFile
          Id="PuppetConfCaServer" Name="puppet.conf"
          Action="addLine"
          Section="main"
          Key="ca_server" Value="[PUPPET_CA_SERVER]"
          Directory="PuppetConfDir" />
      </Component>
      <Component
        Id="PuppetVarDir"
        Permanent="no"
        Guid="B95A17F3-CF5E-4EC7-859E-F10C0965645F"
        Directory="PuppetVarDir">
        <CreateFolder />
      </Component>
      <Component
        Id="PuppetInstallerFacts"
        Permanent="no"
        Guid="4E7C234B-2837-4459-A20E-9503A922FCB9"
        Directory="FactsDotD">
        <CreateFolder>
          <Permission GenericAll="yes" User="Administrators" />
          <Permission GenericRead="yes" GenericExecute="yes" User="Everyone" />
        </CreateFolder>
      </Component>
      <Component
        Id="CodeDir"
        Permanent="no"
        Guid="0D29EB1B-604D-4FE1-A75C-F18CC230BEED"
        Directory="CodeDir">
        <CreateFolder />
      </Component>
      <Component
        Id="HieraDataDir"
        Permanent="no"
        Guid="2438387C-BEA5-47C1-8B43-46FE30E14BEA"
        Directory="HieraDataDir">
        <CreateFolder />
      </Component>
      <Component
        Id="CodeModulesDir"
        Permanent="no"
        Guid="ae4a85a4-a305-4c95-b254-c2f06c586482"
        Directory="CodeModulesDir">
        <CreateFolder />
      </Component>
      <Component
        Id="EnvironmentsDir"
        Permanent="no"
        Guid="6a6a390a-8783-40b6-b49d-9e2b368e069d"
        Directory="EnvironmentsDir">
        <CreateFolder />
      </Component>
      <Component
        Id="ProductionDir"
        Permanent="no"
        Guid="b902efcd-756e-4340-8f13-5a79d46b93c7"
        Directory="ProductionDir">
        <CreateFolder />
      </Component>
      <Component
        Id="ManifestsDir"
        Permanent="no"
        Guid="5484fadf-6d5e-4053-83fc-ea68918d6f2e"
        Directory="ManifestsDir">
        <CreateFolder />
      </Component>
      <Component
        Id="ModulesDir"
        Permanent="no"
        Guid="cbe9cc8d-3a38-4c4c-9f16-39e42093481a"
        Directory="ModulesDir">
        <CreateFolder />
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>
